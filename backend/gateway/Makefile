# Gateway Service Makefile

.PHONY: all run clean docker docker-clean logs

# Default target - run all installations
all:
	@echo "ðŸ“¦ Installing gateway dependencies..."
	npm install
	@echo "Installing .env dependences"
	npm install dotenv dotenv-expand
	@echo "âœ… Gateway service setup complete!"
	@echo "ðŸš€ Starting gateway development server..."
	npm run dev

# Just run the service (assumes already installed)
run:
	@echo "ðŸš€ Starting gateway development server..."
	npm run dev

# Clean up (including Docker)
clean:
	@echo "ðŸ§¹ Cleaning up..."
	rm -rf node_modules
	@echo "ðŸ³ Cleaning Docker resources..."
	docker stop gateway_service 2>/dev/null || true
	docker rm gateway_service 2>/dev/null || true
	docker rmi ft_transcendence_gateway_service 2>/dev/null || true

# Docker: build if needed and start
docker:
	@echo "ðŸ³ Building gateway Docker image..."
	docker build -t ft_transcendence_gateway_service .
	@echo "ðŸ›‘ Stopping existing container if running..."
	docker stop gateway_service 2>/dev/null || true
	docker rm gateway_service 2>/dev/null || true
	@echo "ðŸš€ Starting gateway Docker container..."
	docker network create ft_transcendence_network 2>/dev/null || true
	docker run -d --name gateway_service --network ft_transcendence_network -p 3003:3003 ft_transcendence_gateway_service
	@echo "âœ… Container started! Following logs..."
	@echo "ðŸ“‹ Press Ctrl+C to stop following logs (container keeps running)"
	docker logs -f gateway_service

# Docker: clean existing images for this service
docker-clean:
	@echo "ðŸ§¹ Cleaning up Docker resources for gateway..."
	docker stop gateway_service 2>/dev/null || true
	docker rm gateway_service 2>/dev/null || true
	docker rmi ft_transcendence_gateway_service 2>/dev/null || true

# Docker: follow logs in real-time
logs:
	@echo "ðŸ“‹ Following gateway logs (Ctrl+C to stop)..."
	docker logs -f gateway_service
